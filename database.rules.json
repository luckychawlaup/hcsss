
{
  "rules": {
    ".read": false,
    ".write": false,
    "variables": {
      "principalUID": "IIDjN5e6RzUMFGOYJ4kE7t3YqgZ2",
      "ownerUID": "qEB6D6PbjycGSBKMPv9OGyorgnd2"
    },
    "isAdmin": "auth != null && (auth.uid === root.child('variables/principalUID').val() || auth.uid === root.child('variables/ownerUID').val())",
    
    "students": {
      ".read": "root.child('isAdmin').val()",
      ".write": "root.child('isAdmin').val()",
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "student_registrations": {
      ".read": "root.child('isAdmin').val()",
      ".write": "root.child('isAdmin').val() || auth != null",
      "$key": {
        // Allow a student to claim their account
        ".write": "newData.exists() && !data.exists() || (data.exists() && newData.child('authUid').val() === auth.uid)"
      }
    },
    "teachers": {
      ".read": "root.child('isAdmin').val()",
      ".write": "root.child('isAdmin').val()",
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
     "registrations": {
      ".read": "root.child('isAdmin').val()",
      ".write": "root.child('isAdmin').val() || auth != null"
    },
    "announcements": {
      ".read": "auth != null",
      ".write": "root.child('isAdmin').val()"
    },
    "leaves": {
      ".read": "auth != null",
      ".indexOn": ["userId", "appliedAt"],
      "$leaveId": {
        // A user can create their own leave request
        ".write": "auth != null && (newData.child('userId').val() === auth.uid && !data.exists() || root.child('isAdmin').val())",
        // Teacher can approve leave for their class students
        "status": {
           ".write": "auth != null && (root.child('isAdmin').val() || (auth.uid === data.parent().child('teacherId').val()))"
        }
      }
    },
    "feedback": {
      ".read": "root.child('isAdmin').val()",
      "$feedbackId": {
        // Any authenticated user can submit feedback
        ".write": "auth != null && newData.child('userId').val() === auth.uid && !data.exists()"
      }
    },
    "homework": {
       ".read": "auth != null",
       ".write": "auth != null", // Teachers can write
       ".indexOn": ["classSection", "assignedBy"]
    },
    "salaries": {
      ".read": "auth != null", // Teacher can read their own, admin can read all
      ".write": "root.child('isAdmin').val()",
      ".indexOn": "teacherId"
    },
    "gallery": {
      ".read": "auth != null",
      // Any authenticated user can upload
      ".write": "auth != null"
    },
    "school_settings": {
      ".read": true, // Publicly readable for branding
      ".write": "root.child('isAdmin').val()"
    }
  }
}
